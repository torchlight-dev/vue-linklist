!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.VueLinkList={})}(this,function(e){"use strict";function t(e){var t=e.array,n=e.index,r=e.at;if(n===r||n>t.length-1||r>t.length-1)return t;var i=Object.assign([],t),a=i[n],o=i.slice(n+1);return i.splice(n),Array.prototype.push.apply(i,o),i.splice(r,0,a),i}function n(){var e=document.head||document.getElementsByTagName("head")[0],t=n.styles||(n.styles={}),r="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(n,i){if(!document.querySelector('style[data-vue-ssr-id~="'+n+'"]')){var a=r?i.media||"default":n,o=t[a]||(t[a]={ids:[],parts:[],element:void 0});if(!o.ids.includes(n)){var s=i.source,c=o.ids.length;if(o.ids.push(n),r&&(o.element=o.element||document.querySelector("style[data-group="+a+"]")),!o.element){var d=o.element=document.createElement("style");d.type="text/css",i.media&&d.setAttribute("media",i.media),r&&(d.setAttribute("data-group",a),d.setAttribute("data-next-index","0")),e.appendChild(d)}if(r&&(c=parseInt(o.element.getAttribute("data-next-index")),o.element.setAttribute("data-next-index",c+1)),o.element.styleSheet)o.parts.push(s),o.element.styleSheet.cssText=o.parts.filter(Boolean).join("\n");else{var u=document.createTextNode(s),l=o.element.childNodes;l[c]&&o.element.removeChild(l[c]),l.length?o.element.insertBefore(u,l[c]):o.element.appendChild(u)}}}}}var r={props:{source:{type:Array,required:!0},width:{type:[Number,String],default:640},height:{type:[Number,String],default:480},box:{type:Object,default:function(){return{width:100,height:50,margin:10,space:80}}},defaultPairs:{type:Array,default:function(){return[]}}},data:function(){return{active:{},pairs:[],dragIndex:null,dragCategoryIndex:null,dragY:0}},mounted:function(){Array.isArray(this.defaultPairs)&&0===this.pairs.length&&(this.pairs=this.defaultPairs,this.noticeToParent())},computed:{lines:function(){var e=this;return this.pairs.map(function(t){return{start:Object.assign(t.start,e.findElementIndex(t.start)),end:Object.assign(t.end,e.findElementIndex(t.end))}})},dropIndex:function(){return Math.floor(this.dragY/(this.box.height+this.box.margin))},dragLineY:function(){return(this.box.height+this.box.margin)*this.dropIndex-this.box.margin/2}},methods:{findElementIndex:function(e){var t=e.category,n=e.name,r=this.source.findIndex(function(e){return e.category===t});return{categoryIndex:r,nameIndex:this.source[r].elements.findIndex(function(e){return e.name===n})}},hasConnected:function(e){var t=e.start,n=e.end;return!!this.pairs.find(function(e){return e.start.category===t.category&&e.start.name===t.name&&e.end.category===n.category&&e.end.name===n.name})},onStartClicked:function(e,t){this.$set(this.active,"category",e),this.$set(this.active,"name",t)},onEndClicked:function(e,t){if(this.active.category&&this.active.name){var n=this.findElementIndex({category:this.active.category,name:this.active.name});this.findElementIndex({category:e,name:t}).categoryIndex-n.categoryIndex==1&&(this.hasConnected({start:this.active,end:{category:e,name:t}})||(this.pairs.push({start:{category:this.active.category,name:this.active.name},end:{category:e,name:t}}),this.active={},this.noticeToParent()))}},onLineClicked:function(e){this.removeLine(e)},onDragStarted:function(e,t,n){this.dragCategoryIndex=e,this.dragIndex=t,this.dragY=n.layerY},onDragging:function(e){null!==this.dragCategoryIndex&&(this.dragY=e.layerY)},onDropped:function(){null!==this.dragCategoryIndex&&(this.source[this.dragCategoryIndex].elements=t({array:this.source[this.dragCategoryIndex].elements,index:this.dragIndex,at:this.dropIndex-(this.dragIndex<this.dropIndex?1:0)}),this.onMouseLeft(),this.noticeSourceToParent())},onMouseLeft:function(){this.dragCategoryIndex=null,this.dragIndex=null},removeLine:function(e){this.pairs=this.pairs.filter(function(t){return t.start.category!==e.start.category||t.start.name!==e.start.name||t.end.category!==e.end.category||t.end.name!==e.end.name}),this.noticeToParent()},noticeToParent:function(){this.$emit("updatedList",this.pairs)},noticeSourceToParent:function(){this.$emit("updatedSource",this.source)},categoryX:function(e){return(this.box.width+this.box.space)*e},elementY:function(e){return(this.box.height+this.box.margin)*e},elementTransform:function(e){return"translate(0, "+this.elementY(e)+")"},categoryTransform:function(e){return"translate("+this.categoryX(e)+", 0)"},refreshPairs:function(){var e=this;this.pairs=this.pairs.filter(function(t){var n=e.source.some(function(e){return t.start.category===e.category&&e.elements.some(function(e){return e.name===t.start.name})}),r=e.source.some(function(e){return t.end.category===e.category&&e.elements.some(function(e){return e.name===t.end.name})});return n&&r}),this.noticeToParent()}},watch:{source:{handler:function(e,t){this.refreshPairs()},deep:!0}}},i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("svg",{attrs:{width:e.width,height:e.height,xmlns:"http://www.w3.org/2000/svg"},on:{mouseup:function(t){e.onDropped()},mousemove:e.onDragging,mouseleave:function(t){e.onMouseLeft()}}},[n("g",{attrs:{transform:"translate(20, 20)"}},[e._l(e.lines,function(t){return n("line",{attrs:{x1:e.categoryX(t.start.categoryIndex)+e.box.width,y1:e.elementY(t.start.nameIndex)+e.box.height/2,x2:e.categoryX(t.end.categoryIndex),y2:e.elementY(t.end.nameIndex)+e.box.height/2,"stroke-width":"10",stroke:"rgb(119, 0, 255)"},on:{click:function(n){e.onLineClicked(t)}}})}),e._l(e.source,function(t,r){return n("g",{attrs:{transform:e.categoryTransform(r)}},[e.dragCategoryIndex===r?n("line",{attrs:{x1:-20,y1:e.dragLineY,x2:e.box.width+20,y2:e.dragLineY,"stroke-width":"2",stroke:"rgb(100, 0, 255)"}}):e._e(),e._l(t.elements,function(i,a){return[n("g",{attrs:{transform:e.elementTransform(a)}},[n("g",{on:{mousedown:function(t){e.onDragStarted(r,a,t)}}},[n("rect",{attrs:{x:"0",y:"0",height:e.box.height,width:e.box.width,"stroke-width":"1.5",stroke:e.dragCategoryIndex===r&&e.dragIndex===a?"rgb(100, 0, 255)":"#000",fill:e.dragCategoryIndex===r&&e.dragIndex===a?"rgb(100, 0, 255)":"#fff"}}),n("foreignObject",{attrs:{width:e.box.width,height:e.box.height}},[e._t("default",null,{element:i,categoryIndex:r,elementIndex:a,xmlns:"http://www.w3.org/1999/xhtml"})],2)],1),n("g",[r!==e.source.length-1?n("circle",{class:{active:e.active.category===t.category&&e.active.name===i.name},attrs:{cx:e.box.width,cy:e.box.height/2,r:"10"},on:{click:function(n){e.onStartClicked(t.category,i.name)}}}):e._e(),0!==r?n("circle",{class:{active:!1},attrs:{cx:0,cy:e.box.height/2,r:"10"},on:{click:function(n){e.onEndClicked(t.category,i.name)}}}):e._e()])])]})],2)})],2)])},a=[];i._withStripped=!0;var o=function(e,t,n,r,i,a,o,s){var c=("function"==typeof n?n.options:n)||{};c.__file="/Users/genichiro/git/vue-linklist/src/linklist.vue",c.render||(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,i&&(c.functional=!0)),c._scopeId=r;var d;if(t&&(d=function(e){t.call(this,o(e))}),void 0!==d)if(c.functional){var u=c.render;c.render=function(e,t){return d.call(t),u(e,t)}}else{var l=c.beforeCreate;c.beforeCreate=l?[].concat(l,d):[d]}return c}({render:i,staticRenderFns:a},function(e){e&&e("data-v-67a180fa_0",{source:"\ncircle[data-v-67a180fa] {\n  fill: #333;\n  transition: all 0.4s cubic-bezier(0.17, 0.67, 0.88, 1.74);\n  stroke: #7700ff;\n  stroke-width: 1px;\n}\n.active[data-v-67a180fa] {\n  fill: white;\n  stroke-width: 5px;\n}\nline[data-v-67a180fa]:hover {\n  stroke: #9f64ff;\n}\nforeignObject[data-v-67a180fa] {\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n\n/*# sourceMappingURL=linklist.vue.map */",map:{version:3,sources:["/Users/genichiro/git/vue-linklist/src/linklist.vue","linklist.vue"],names:[],mappings:";AA6PA;EACA,WAAA;EACA,0DAAA;EACA,gBAAA;EACA,kBAAA;CACA;AACA;EACA,YAAA;EACA,kBAAA;CACA;AACA;EACA,gBAAA;CACA;AACA;EACA,0BACA;KADA,uBACA;MADA,sBACA;UADA,kBACA;CAAA;;AC5PA,wCAAwC",file:"linklist.vue",sourcesContent:[null,"circle {\n  fill: #333;\n  transition: all 0.4s cubic-bezier(0.17, 0.67, 0.88, 1.74);\n  stroke: #7700ff;\n  stroke-width: 1px; }\n\n.active {\n  fill: white;\n  stroke-width: 5px; }\n\nline:hover {\n  stroke: #9f64ff; }\n\nforeignObject {\n  user-select: none; }\n\n/*# sourceMappingURL=linklist.vue.map */"]},media:void 0})},r,"data-v-67a180fa",!1,void 0,n,void 0);e.default=o,Object.defineProperty(e,"__esModule",{value:!0})});
